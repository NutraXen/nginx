    # -------------------------------------
    #     TYPO DOMAIN NAMES - REDIRECT    -
    #--------------------------------------
    server {
      listen      80;
      server_name dec.al decalciious.net decalishus.com;
      rewrite ^ http://www.decalicious.com$request_uri? permanent;
      access_log          /dev/null;
      error_log           /dev/null;
    }

#----------------------------------------------------------------------------------------------------------------------------------------------------

    # -------------------------------------------
    #          BACKEND IIS SERVER FARM          -
    # -------------------------------------------
    upstream iis-servers-decalicious {

     # STICKY IP (SAME SERVER BASED ON IP)
     ip_hash;

     # UPSTREAM IIS SERVERS (Add More As Needed)
     server ww1.decalicious.com;
     #server ww2.decalicious.com;
     #server ww3.decalicious.com;
     #server ww4.decalicious.com;
     #server ww5.decalicious.com;

     # HEALTH CHECK SETTINGS (Milisecond Intervals) > https://github.com/yaoweibin/nginx_upstream_check_module
     check interval=50000 rise=1 fall=2 timeout=2500 type=http;
     check_http_send "GET /iis-health/default.asp HTTP/1.0\r\nHost: decalicious.com\r\n\r\n";
     check_http_expect_alive http_2xx http_3xx;
   }


#----------------------------------------------------------------------------------------------------------------------------------------------------


   # ----------------------------------------------------------
   #    X.Decalicious.com/x (Static Content | CDN PULL URL)
   # ----------------------------------------------------------
   server {

    # SERVER SPECIFIC SETTINGS
    listen                80;
    server_name           x.decalicious.com;
    root                  /usr/share/nginx/sites/decalicious-down/;
    keepalive_timeout     5s;
    allow                 all;
    server_tokens         off; 
    more_clear_headers    'Cache-Control';

    # Show Default Local Page for items outside of X
    location / {
      more_set_headers      "X-INFO: Forbidden";      
      break;
    }

   # ----------------------------------------------------------
   #       x.Decalicious.com/s3 (Static Content Amazon S3)
   # ----------------------------------------------------------
    location ~* ^/x/s3/(.*) {

      set $s3_bucket           'decalicious.s3.amazonaws.com';
      set $url_full            '$1';

      # HEADERS
      more_set_headers          "Server: S3-DECALS";
      # CACHE BROWSER 425 DAYS (36720000) | CDN EDGE 30 DAYS (262800)
      add_header                Cache-Control "no-transform,public,max-age=36720000, s-maxage=262800";
      etag                      on;
      expires                   425d;
      
      # Cache File Information
      open_file_cache           max=1000 inactive=500s;
      open_file_cache_valid     600s;
      open_file_cache_errors    on;

      # Gzip
      gzip                      on;
      gzip_vary                 on;
      gzip_http_version         1.0;
      gzip_disable              "MSIE [1-6].(?!.*SV1)";
      gzip_min_length           200;
      gzip_buffers              64 8k;
      gzip_comp_level           3;
      gzip_proxied              any;
      gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript font/ttf font/opentype application/vnd.ms-fontobject image/svg+xml;

      # PROXY SETTINGS
      proxy_set_header          Accept-Encoding "";
      proxy_http_version        1.1;
      proxy_redirect            off;
      proxy_set_header          Host $s3_bucket;
      proxy_set_header          Authorization '';

      proxy_hide_header         x-amz-id-2;
      proxy_hide_header         x-amz-request-id;
      proxy_hide_header         x-amz-meta-tag;
      proxy_hide_header         x-amz-meta-uuid;
      
      proxy_hide_header         Set-Cookie;
      proxy_ignore_headers      "Set-Cookie";
      proxy_buffering           off;
      resolver                  8.8.4.4 8.8.8.8 valid=300s;
      resolver_timeout          10s;
      proxy_pass                http://$s3_bucket/$url_full;
      proxy_temp_path           /usr/share/nginx/temp;

      # PROXY CACHING
      proxy_cache               STATIC;
      proxy_cache_valid         200 302 1d;
      proxy_cache_valid         404     1m;
      proxy_cache_use_stale     error timeout invalid_header updating
      http_500 http_502 http_503 http_504;

      #HTTP ERRORS LOCALLY 
      proxy_intercept_errors on; 
      error_page 500 502 503 504 =503 /maintenance.html;
      error_page 404 =404 /404.html;      
      break;
    }



    location ~* /(x/|app/|favicon.ico) {
    
      # HEADERS
      more_set_headers          "Server: X-DECALS";
      # CACHE BROWSER 425 DAYS (36720000) | CDN EDGE 30 DAYS (262800)
      add_header                Cache-Control "no-transform,public,max-age=36720000, s-maxage=262800";
      etag                      on;
      expires                   425d;
      
      # Cache File Information
      open_file_cache           max=1000 inactive=500s;
      open_file_cache_valid     600s;
      open_file_cache_errors    on;

      # Gzip
      gzip                      on;
     #gzip_vary                 on;
      gzip_http_version         1.1;
      gzip_disable              "MSIE [1-6].(?!.*SV1)";
      gzip_min_length           1;
      gzip_buffers              64 8k;
      gzip_comp_level           3;
      gzip_proxied              any;
     #gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;
      gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript font/ttf font/opentype application/vnd.ms-fontobject image/svg+xml;

 
      # PROXY SETTINGS
      proxy_http_version        1.1;
      proxy_redirect            off;
      proxy_set_header          Host              "www.decalicious.com";
     #proxy_set_header          X-Real-IP         $remote_addr;
     #proxy_set_header          X-Forwarded-For   $proxy_add_x_forwarded_for;
     #proxy_set_header          X-Forwarded-Proto $scheme;
      proxy_pass                http://iis-servers-decalicious;
      proxy_temp_path           /usr/share/nginx/temp;
     #proxy_connect_timeout     5;
     #proxy_read_timeout        240;

      # PROXY CACHING
      proxy_cache               STATIC;
      proxy_cache_valid         200 302 1d;
      proxy_cache_valid         404     1m;
      proxy_cache_use_stale     error timeout invalid_header updating
      http_500 http_502 http_503 http_504;

      #HTTP ERRORS LOCALLY 
      proxy_intercept_errors on; 
      error_page 500 502 503 504 =503 /maintenance.html;
      #error_page 404 =404 /404.html;      
      break;
    }

    # ERROR PAGE - DOWN FOR MAINTENANCE
    location  ^~ /maintenance.html {
      root   /usr/share/nginx/sites/decalicious-down/;
      index  maintenance.html index.html index.htm;
      allow all;
    }

    # EROR PAGE - LOCAL 404 PAGE
    location  ^~ /404.html {
      root   /usr/share/nginx/sites/decalicious-down/;
      index  404.html index.html index.htm;
      allow all;
    }

    # LOCAL ERROR PAGE SCRIPTS AND IMAGES (XS Directory)
    location /xs {
      root   /usr/share/nginx/sites/decalicious-down/;
      allow  all;     
   }

   # ERROR PAGES (LOCAL)
   error_page 404 =404 /usr/share/nginx/sites/decalicious-down/404.html;
   error_page 500 502 503 504 =503 /usr/share/nginx/sites/decalicious-down/maintenance.html;

   # NO LOGGING
   access_log          /dev/null;
   error_log           /dev/null;
   # DEBUG LOGGING
   #error_log           /var/log/nginx/decalicious.com.error.log ;
   #access_log          /var/log/nginx/decalicious.com.log ;

  }


#----------------------------------------------------------------------------------------------------------------------------------------------------


   # ----------------------------------------------------------
   #       WWW.DECALICIOUS.COM (Or Other Subdomains?)
   # ----------------------------------------------------------
   server {

    # SERVER SPECIFIC SETTINGS
    listen                80;
    listen                443 ssl spdy default_server;  
    server_name           www.decalicious.com frank.decalicious.com;

    # SSL CERT & KEY
    ssl_certificate /usr/share/nginx/ssl-certs/decalicious_com/decalicious_com_bundle.crt;
    ssl_certificate_key /usr/share/nginx/ssl-certs/decalicious_com/decalicious_com.key;

    # SSL SETTINGS
    ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    ssl_ciphers         HIGH:!aNULL:!MD5;

    # SITE LOCATION
    root                  /usr/share/nginx/sites/decalicious-down/;
    keepalive_timeout     5s;
    allow                 all;
    server_tokens         off; 
    
    # CLEAR CACHE CONTROL FROM IIS BACKEND
    more_clear_headers    'Cache-Control';
    
    # IIS FARM DASHBOARD  //www.decalicious.com/iis-servers-decalicoius
    location /dashboard/nginx {
      check_status;
      access_log   off;
      allow all;
    }

    # MAIN SITE LOCATION (NO CACHING)
    location / {


      # RULES FOR FORCING SSL
      set $force_SSL T; 

      if ($ssl_protocol = "") {
        set $force_SSL     "${force_SSL}E"; 
        more_set_headers   "x-error-1: NOT USING SSL";
      }

      if ($http_user_agent ~ NT 6.1) {
        set $force_SSL     "${force_SSL}S"; 
        more_set_headers   "x-error-1: WINDOWS XP";
      }


      if ($force_SSL = TE) {
        rewrite ^ https://$server_name$request_uri? permanent; 
      }



      # ADDITIONAL HEADERS
      more_set_headers          "Server: DECALS";
      add_header                Cache-Control "public, max-age=60";
      etag                      on;
      expires                   60s;

      # Gzip
      gzip                      on;
      gzip_vary                 on;
      gzip_http_version         1.0;
      gzip_disable              "MSIE [1-6].(?!.*SV1)";
      gzip_min_length           750;
      gzip_buffers              64 8k;
      gzip_comp_level           3;
      gzip_proxied              any;
      gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;
      
      # Cache File Information
      open_file_cache           max=1000 inactive=500s;
      open_file_cache_valid     600s;
      open_file_cache_errors    on;

      # PROXY SETTINGS
      proxy_redirect            off;
      proxy_set_header          Host              "www.decalicious.com";
      proxy_set_header          X-Real-IP         $remote_addr;
      proxy_set_header          X-Forwarded-For   $proxy_add_x_forwarded_for;
      proxy_set_header          X-Forwarded-Proto $scheme;
      proxy_pass                http://iis-servers-decalicious;
      proxy_temp_path           /usr/share/nginx/temp;
      #proxy_connect_timeout    5;
      #proxy_read_timeout       240;

      # PROXY CACHING
      #proxy_cache               off;
      proxy_cache               STATIC;
      proxy_cache_valid         200 302 1d;
      proxy_cache_valid         404     1m;
      proxy_cache_use_stale     error timeout invalid_header updating
      http_500 http_502 http_503 http_504;

      #HTTP ERRORS LOCALLY 
      proxy_intercept_errors on; 
      error_page 500 502 503 504 =503 /maintenance.html;
      error_page 404 =404 /404.html;      

      break;

  }

 
    # MAIN SITE LOCATION (NO CACHING)
    location /api {

      # ADDITIONAL HEADERS
      more_set_headers          "Server: DECALS-API";
      add_header                Cache-Control "private";
      etag                      on;
      expires                   1s;

      # Gzip
      gzip                      on;
      gzip_vary                 on;
      gzip_http_version         1.0;
      gzip_disable              "MSIE [1-6].(?!.*SV1)";
      gzip_min_length           750;
      gzip_buffers              64 8k;
      gzip_comp_level           3;
      gzip_proxied              any;
      gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;
      
      # Cache File Information
      #open_file_cache           max=1000 inactive=500s;
      #open_file_cache_valid     600s;
      #open_file_cache_errors    on;

      # PROXY SETTINGS
      proxy_redirect            off;
      proxy_set_header          Host              "www.decalicious.com";
      proxy_set_header          X-Real-IP         $remote_addr;
      proxy_set_header          X-Forwarded-For   $proxy_add_x_forwarded_for;
      proxy_set_header          X-Forwarded-Proto $scheme;
      proxy_pass                http://iis-servers-decalicious;
      proxy_temp_path           /usr/share/nginx/temp;
      #proxy_connect_timeout    5;
      #proxy_read_timeout       240;

      # PROXY CACHING
      proxy_cache               off;

      #HTTP ERRORS LOCALLY 
      proxy_intercept_errors on; 
      error_page 500 502 503 504 =503 /maintenance.html;
      #error_page 404 =404 /404.html;      

      #CORS WITH DECALICIOUS SUBDOMAINS
      if ($http_origin ~* (.*\.decalicious.com)) { 
        set $cors "true"; 
      }
      if ($cors = "true") { 
          add_header 'Access-Control-Allow-Origin' "$http_origin"; 
          add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, DELETE, PUT'; 
          add_header 'Access-Control-Allow-Credentials' 'true'; 
          add_header 'Access-Control-Allow-Headers' 'User-Agent,Keep-Alive,Content-Type'; 
      } 
      if ($request_method = OPTIONS) { 
          return 204; 
      } 

      break;
    }





   # ----------------------------------------------------------
   #       www.Decalicious.com/Blog (Reverse Proxy Blogger)
   # ----------------------------------------------------------
    location = /blog/ {
      #Remove Trailing Slashes
      rewrite ^/(.*)$ http://www.decalicious.com/blog permanent;
    }

    location ~* ^/blog(.*) {

      # Make sure blog is only available under www domain
      if ( $host != 'www.decalicious.com' ) {
        rewrite ^/(.*)$ http://www.decalicious.com/$1 permanent;
      }

      # Turn off SSL for Blog
      if ($ssl_protocol != "") {
       rewrite ^   http://$server_name$request_uri? permanent;
      }

      location ~* ^/blog/robots.txt {
        deny all;
      }

      # Rewrite outbound text to new url | rewrite https for image sources
      subs_filter               blog.decalicious.com/ www.decalicious.com/blog/;

      # Variables so we can redirect later
      set $blog_url            'blog.decalicious.com';
      set $url_full            '$1';

      # HEADERS
      more_set_headers          "Server: DECALS-BL";
      add_header                Cache-Control "public, max-age=3600";
      etag                      on;
      expires                   1h;
      
      # Cache File Information
      open_file_cache           max=1000 inactive=500s;
      open_file_cache_valid     600s;
      open_file_cache_errors    on;

      # Gzip
      gzip                      on;
      gzip_vary                 on;
      gzip_http_version         1.0;
      gzip_disable              "MSIE [1-6].(?!.*SV1)";
      gzip_min_length           200;
      gzip_buffers              64 8k;
      gzip_comp_level           3;
      gzip_proxied              any;
      gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;
 
      # PROXY SETTINGS
      proxy_set_header          Accept-Encoding "";
      proxy_http_version        1.1;
      proxy_redirect            off;
      proxy_set_header          Host $blog_url;
      proxy_set_header          Authorization '';
      proxy_hide_header         Set-Cookie;
      proxy_ignore_headers      "Set-Cookie";
      proxy_buffering           off;
      resolver                  8.8.4.4 8.8.8.8 valid=300s;
      resolver_timeout          10s;
      proxy_pass                http://$blog_url/$url_full;
      proxy_temp_path           /usr/share/nginx/temp;

      # PROXY CACHING
      proxy_cache               STATIC;
      proxy_cache_valid         200 302 1d;
      proxy_cache_valid         404     1m;
      proxy_cache_use_stale     error timeout invalid_header updating
      http_500 http_502 http_503 http_504;

      #HTTP ERRORS LOCALLY 
      proxy_intercept_errors on; 
      error_page 500 502 503 504 =503 /maintenance.html;
      #error_page 404 =404 /404.html;      
      break;
    }


   # ----------------------------------------------------------
   #       www.Decalicious.com/s3 (Static Content Amazon S3)
   # ----------------------------------------------------------
    location ~* ^/x/s3/(.*) {


      set $s3_bucket           'decalicious.s3.amazonaws.com';
      set $url_full            '$1';

      # HEADERS
      more_set_headers          "Server: DECALS-S3";
      add_header                Cache-Control "no-transform,public,max-age=36720000";
      etag                      on;
      expires                   425d;
      
      # Cache File Information
      open_file_cache           max=1000 inactive=500s;
      open_file_cache_valid     600s;
      open_file_cache_errors    on;

      # Gzip
      gzip                      on;
      gzip_vary                 on;
      gzip_http_version         1.0;
      gzip_disable              "MSIE [1-6].(?!.*SV1)";
      gzip_min_length           200;
      gzip_buffers              64 8k;
      gzip_comp_level           3;
      gzip_proxied              any;
      gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript font/ttf font/opentype application/vnd.ms-fontobject image/svg+xml;

      # PROXY SETTINGS
      proxy_set_header          Accept-Encoding "";
      proxy_http_version        1.1;
      proxy_redirect            off;
      proxy_set_header          Host $s3_bucket;
      proxy_set_header          Authorization '';

      proxy_hide_header         x-amz-id-2;
      proxy_hide_header         x-amz-request-id;
      proxy_hide_header         x-amz-meta-tag;
      proxy_hide_header         x-amz-meta-uuid;
      
      proxy_hide_header         Set-Cookie;
      proxy_ignore_headers      "Set-Cookie";
      proxy_buffering           off;
      resolver                  8.8.4.4 8.8.8.8 valid=300s;
      resolver_timeout          10s;
      proxy_pass                http://$s3_bucket/$url_full;
      proxy_temp_path           /usr/share/nginx/temp;

      # PROXY CACHING
      proxy_cache               STATIC;
      proxy_cache_valid         200 302 1d;
      proxy_cache_valid         404     1m;
      proxy_cache_use_stale     error timeout invalid_header updating
      http_500 http_502 http_503 http_504;

      #HTTP ERRORS LOCALLY 
      proxy_intercept_errors on; 
      error_page 500 502 503 504 =503 /maintenance.html;
      #error_page 404 =404 /404.html;      
      break;
    }

   # -------------------------------------------------------------------------------------------
   #       www.Decalicious.com/x (IN CASE WE ARE NOT USING A CDN | RELATIVE PATHS)
   # -------------------------------------------------------------------------------------------
    #location /x/ {
    location ~* /(x/|app/|favicon.ico) {

      # HEADERS
      more_set_headers          "Server: DECALS-X";
      add_header                Cache-Control "no-transform,public,max-age=36720000";
      etag                      on;
      expires                   425d;
      
      # Cache File Information
      open_file_cache           max=1000 inactive=500s;
      open_file_cache_valid     600s;
      open_file_cache_errors    on;

      # Gzip
      gzip                      on;
      gzip_vary                 on;
      gzip_http_version         1.0;
      gzip_disable              "MSIE [1-6].(?!.*SV1)";
      gzip_min_length           200;
      gzip_buffers              64 8k;
      gzip_comp_level           3;
      gzip_proxied              any;
      #gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript;
      gzip_types                text/plain text/css application/x-javascript text/xml application/xml application/xml+rss text/javascript font/ttf font/opentype application/vnd.ms-fontobject image/svg+xml;

 
      # PROXY SETTINGS
      proxy_http_version        1.1;
      proxy_redirect            off;
      proxy_set_header          Host              $http_host;
      proxy_set_header          X-Real-IP         $remote_addr;
      proxy_set_header          X-Forwarded-For   $proxy_add_x_forwarded_for;
      proxy_set_header          X-Forwarded-Proto $scheme;
      proxy_pass                http://iis-servers-decalicious;
      proxy_temp_path           /usr/share/nginx/temp;
      #proxy_connect_timeout    5;
      #proxy_read_timeout       240;

      # PROXY CACHING
      proxy_cache               STATIC;
      proxy_cache_valid         200 302 1d;
      proxy_cache_valid         404     1m;
      proxy_cache_use_stale     error timeout invalid_header updating
      http_500 http_502 http_503 http_504;

      #HTTP ERRORS LOCALLY 
      proxy_intercept_errors on; 
      error_page 500 502 503 504 =503 /maintenance.html;
      #error_page 404 =404 /404.html;      
      break;
    }

    # ERROR PAGE - DOWN FOR MAINTENANCE
    location  ^~ /maintenance.html {
      root   /usr/share/nginx/sites/decalicious-down/;
      index  maintenance.html index.html index.htm;
      allow all;
    }

    # EROR PAGE - LOCAL 404 PAGE
    location  ^~ /404.html {
      root   /usr/share/nginx/sites/decalicious-down/;
      index  404.html index.html index.htm;
      allow all;
    }

    # LOCAL ERROR PAGE SCRIPTS AND IMAGES (XS Directory)
    location /xs {
      root   /usr/share/nginx/sites/decalicious-down/;
      allow  all;    	
   }

   # ERROR PAGES (LOCAL)
   error_page 404  /usr/share/nginx/sites/decalicious-down/404.html;
   error_page 500 502 503 504 =503 /usr/share/nginx/sites/decalicious-down/maintenance.html;


   # NO LOGGING
   access_log          /dev/null;
   error_log           /dev/null;
   # DEBUG LOGGING
   #error_log           /var/log/nginx/decalicious.com.error.log ;
   #access_log          /var/log/nginx/decalicious.com.log ;
 }
